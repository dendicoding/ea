{% extends "base.html" %}

{% block title %}Home - Search Posts{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">üîç Search Posts</h1>
    
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <input type="text" id="searchInput" class="form-control" placeholder="Search posts by title or content...">
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-10">
            <div id="results"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const searchInput = document.getElementById('searchInput');
    const results = document.getElementById('results');

    // Carica posts all'avvio
    loadPosts();

    searchInput.addEventListener('input', (e) => {
        loadPosts(e.target.value);
    });

    async function loadPosts(query = '') {
        try {
            const response = await fetch('/posts');
            const posts = await response.json();
            
            const filtered = posts.filter(post => 
                post.title.toLowerCase().includes(query.toLowerCase()) ||
                (post.content && post.content.toLowerCase().includes(query.toLowerCase()))
            );

            if (filtered.length > 0) {
                results.innerHTML = filtered.map(post => `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${post.title}</h5>
                            <p class="card-text">${post.content || 'No content'}</p>
                            <p class="card-text">
                                <small class="text-muted">By ${post.username || 'User #' + post.user_id} - ${new Date(post.created_at).toLocaleDateString()}</small>
                            </p>
                        </div>
                    </div>
                `).join('');
            } else {
                results.innerHTML = '<div class="alert alert-info">No posts found</div>';
            }
        } catch (error) {
            results.innerHTML = '<div class="alert alert-danger">Error loading posts</div>';
        }
    }
</script>
{% endblock %}